# ƒêHTN - Data Models & API Contracts

## Service Layer Overview

The application uses a **service-oriented architecture** with 65 service files providing business logic and API communication.

---

## Core Services

### Document Services

| Service                      | Size | Methods | Description                  |
| ---------------------------- | ---- | ------- | ---------------------------- |
| `document.service.ts`        | 28KB | 85+     | Main document operations     |
| `document-in.service.ts`     | 12KB |         | Incoming document handling   |
| `document-out.service.ts`    | 24KB |         | Outgoing document processing |
| `document-record.service.ts` | 16KB |         | Work records management      |

### Key Document Operations

```typescript
// From document.service.ts
DocumentService.getReceiveAndSend(docId: number)
DocumentService.getAllDocumentOut()
DocumentService.getWaitingDocumentOut(page: number)
DocumentService.getDoneDocumentOut(page: number)
DocumentService.getDocumentOutById(documentId: number)
DocumentService.doSaveDocumentOut(document, documentId)
DocumentService.doRejectDocument(item: RejectDocument)
DocumentService.doRetakeDocument(item)
DocumentService.doDoneDocumentTask(documentId, comment, files, isFinish)
```

---

### Task Services

| Service             | Size | Description          |
| ------------------- | ---- | -------------------- |
| `task.service.ts`   | 19KB | Task management (v1) |
| `taskv2.service.ts` | 15KB | Task management (v2) |

---

### Security Services

| Service                 | Size  | Description         |
| ----------------------- | ----- | ------------------- |
| `encryption.service.ts` | 31KB  | Document encryption |
| `decryption.service.ts` | 25KB  | Document decryption |
| `signature.service.ts`  | 2.5KB | Digital signature   |

---

### File Services

| Service                        | Size | Description            |
| ------------------------------ | ---- | ---------------------- |
| `file.service.ts`              | 29KB | File operations        |
| `upload-file.service.ts`       | 12KB | File uploads           |
| `upload-encryption.service.ts` | 10KB | Encrypted file uploads |

---

## API Layer Architecture

### Axios Instances

```typescript
// Protected instance (with JWT)
protectedAxiosInstance
  - Auto-attaches Bearer token
  - Handles 401 with token refresh
  - Adds ?encrypt=true when encryption enabled

// Public instance
publicAxiosInstance
  - No authentication required
```

### API Helpers

```typescript
import { sendGet, sendPost, publicPost } from "@/api";

// Protected requests
sendGet("/documents/123");
sendPost("/documents", data);

// Public requests
publicPost("/users/login", credentials);
```

---

## Type Definitions (`/definitions/types/`)

39 type files covering:

| Category         | Types                                                         |
| ---------------- | ------------------------------------------------------------- |
| **Auth**         | `AuthState`, `LoginRequest`, `UserInfo`, `Role`, `ModuleNode` |
| **Document**     | `RejectDocument`, `DocumentDetail`, `DocumentList`            |
| **Task**         | `Task`, `TaskAssignment`, `TaskProgress`                      |
| **Calendar**     | `CalendarEvent`, `WorkSchedule`                               |
| **Organization** | `Organization`, `Department`, `User`                          |

---

## Validation Schemas (`/schemas/`)

| Schema                    | Purpose                 |
| ------------------------- | ----------------------- |
| `profile.schema.ts`       | User profile validation |
| `calendar-room.schema.ts` | Room booking validation |
| `daily-report.schema.ts`  | Report form validation  |
| `list-job.schema.ts`      | Job list validation     |
| `self-declare.schema.ts`  | Self-declaration form   |
| `regular.schema.ts`       | Common field patterns   |
| `declare-phong.schema.ts` | Room declaration        |
| `watch-item.schema.ts`    | Watch list items        |

---

## API Endpoints Pattern

| Prefix                  | Domain                          |
| ----------------------- | ------------------------------- |
| `/users/*`              | Authentication, user management |
| `/documents/*`          | Document CRUD operations        |
| `/tasks/*`              | Task management                 |
| `/workflow/*`           | Workflow engine                 |
| `/calendar2/*`          | Calendar operations             |
| `/vehicle-usage-plan/*` | Vehicle management              |
| `/organizations/*`      | Organization hierarchy          |
| `/categories/*`         | Category management             |
| `/files/*`              | File uploads/downloads          |

---

_Generated by BMad Document Project Workflow | 2026-01-14_
